<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberDAO">
	
	<resultMap id="findId" type="egovframework.let.member.service.MemberVO">
		<result property="esntlId" column="ESNTL_ID"/>
		<result property="emplyrId" column="EMPLYR_ID"/>
		<result property="userNm" column="USER_NM"/>
		<result property="emailAdres" column="EMAIL_ADRES"/>
	</resultMap>
	
	<resultMap id="findPassword" type="egovframework.let.member.service.MemberVO">
		<result property="esntlId" column="ESNTL_ID"/>
		<result property="emplyrId" column="EMPLYR_ID"/>
		<result property="userNm" column="USER_NM"/>
		<result property="emailAdres" column="EMAIL_ADRES"/>
	</resultMap>
	
	<select id="memberDAO.findId" resultMap="findId">
		SELECT
			ESNTL_ID
			, EMPLYR_ID 
			, USER_NM 
			, EMAIL_ADRES
		FROM LETTNEMPLYRINFO
		WHERE EMPLYR_STTUS_CODE = 'P'
			AND USER_NM = #{userNm}
			AND PASSWORD_HINT = #{passwordHint}
			AND PASSWORD_CNSR = #{passwordCnsr}
			AND EMAIL_ADRES = #{emailAdres}
		ORDER BY SBSCRB_DE DESC
		LIMIT 1
	</select>
	
	<select id="memberDAO.findPassword" resultMap="findPassword">
		SELECT
			ESNTL_ID
			, EMPLYR_ID 
			, USER_NM 
			, EMAIL_ADRES
		FROM LETTNEMPLYRINFO
		WHERE EMPLYR_STTUS_CODE = 'P'
			AND EMPLYR_ID = #{emplyrId}
			AND USER_NM = #{userNm}
			AND PASSWORD_HINT = #{passwordHint}
			AND PASSWORD_CNSR = #{passwordCnsr}
		ORDER BY SBSCRB_DE DESC
		LIMIT 1
	</select>
	
	<update id="memberDAO.passwordUpdate">
		UPDATE LETTNEMPLYRINFO SET
			PASSWORD = #{password}
		WHERE ESNTL_ID = #{esntlId}
	</update>
	
	<select id="memberDAO.selectMberList" resultType="egovMap">
		SELECT
			ESNTL_ID
			, EMPLYR_ID 
			, USER_NM 
			, EMAIL_ADRES
			, SBSCRB_DE
		FROM LETTNEMPLYRINFO
		
		<include refid="selectMberListWhere"></include> 
		
		ORDER BY SBSCRB_DE DESC
		LIMIT #{recordCountPerPage} OFFSET #{firstIndex}
	</select>
	
	<select id="memberDAO.selectMberListCnt" resultType="java.lang.Integer">
		SELECT
		 COUNT(*) CNT
		FROM LETTNEMPLYRINFO
		<include refid="selectMberListWhere"></include> 
	</select>
	
	<sql id="selectMberListWhere">
		<where>
			EMPLYR_STTUS_CODE = 'P'
			<choose>
				<when test='searchCondition == "0"'>
					AND EMPLYR_ID LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
				<when test='searchCondition == "1"'>
					AND USER_NM LIKE CONCAT('%', #{searchKeyword}, '%')
				</when>
			</choose>
		</where>
	</sql>
	
	<select id="memberDAO.selectMber" resultType="egovMap">
		SELECT
			ESNTL_ID
			, EMPLYR_ID 
			, USER_NM 
			, EMAIL_ADRES
			, SBSCRB_DE
		FROM LETTNEMPLYRINFO
		WHERE ESNTL_ID = #{esntlId}
		 AND EMPLYR_STTUS_CODE = 'P'
	</select>
</mapper>